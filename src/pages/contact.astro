---
import Layout from '../layouts/Layout.astro';
import Header from '../components/nav/Header.astro';
import Footer from '../components/nav/Footer.astro';

import IconBadge from '../components/ui/IconBadge.astro';
const siteUrl = Astro.site?.toString() ?? 'https://akwebsolutions.nl';
const pageUrl = `${siteUrl}/contact`;

const contactSignals = [
  { value: '< 1 dag', label: 'Reactietijd via mail' },
  { value: '2 weken', label: 'Van intake tot eerste sprint' },
  { value: 'Hybrid', label: 'Remote + on-site mogelijk' },
];

const faqs = [
  {
    question: 'Hoe snel plannen we een kennismaking in?',
    answer: 'Na je bericht ontvang je binnen één werkdag een voorstel. Meestal plannen we binnen vijf werkdagen een strategiecall in.',
  },
  {
    question: 'Kunnen we direct een call inplannen?',
    answer: 'Ja, via de knop “Plan direct een call” kies je zelf een moment in onze agenda. We bereiden de call voor op basis van jouw input.',
  },
  {
    question: 'Wat moet ik voorbereiden?',
    answer: 'Een korte beschrijving van je doelen, huidige website en belangrijkste KPI’s is genoeg. Eventuele analytics of campagne-data mag je later delen.',
  },
];

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: faqs.map((item) => ({
    '@type': 'Question',
    name: item.question,
    acceptedAnswer: {
      '@type': 'Answer',
      text: item.answer,
    },
  })),
};

const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    {
      '@type': 'ListItem',
      position: 1,
      name: 'Home',
      item: siteUrl,
    },
    {
      '@type': 'ListItem',
      position: 2,
      name: 'Contact',
      item: pageUrl,
    },
  ],
};

const contactSchema = {
  '@context': 'https://schema.org',
  '@type': 'ContactPage',
  name: 'Contact AK Web Solutions',
  url: pageUrl,
  description: 'Neem contact op met AK Web Solutions voor strategie, webdesign, development en marketing automation.',
  contactType: 'sales',
  contactOption: 'CustomerService',
  inLanguage: ['nl', 'en'],
  telephone: '+31685722387',
  email: 'info@akwebsolutions.nl',
  areaServed: 'NL',
  address: {
    '@type': 'PostalAddress',
    addressLocality: 'Baarn',
    addressCountry: 'NL',
  },
};

const heroMetrics = [
  { value: '< 1 dag', label: 'Reactietijd' },
  { value: '45 min', label: 'Kickstart sessie' },
  { value: 'Hybrid', label: 'Remote + on-site' },
];

const heroHighlights = [
  {
    icon: { set: 'heroicons-outline', name: 'sparkles' },
    title: 'Strategiecall',
    body: 'We bereiden de call voor op basis van jouw doelen en data.',
  },
  {
    icon: { set: 'heroicons-outline', name: 'clipboard-document-check' },
    title: 'Concreet voorstel',
    body: 'Binnen 24 uur ontvang je een plan voor sprint één en volgende stappen.',
  },
  {
    icon: { set: 'heroicons-outline', name: 'chat-bubble-oval-left-ellipsis' },
    title: 'Direct contact',
    body: 'Je spreekt met strategen en makers. Geen saleslaag ertussen.',
  },
];
---

<Layout
  title="Contact – AK Web Solutions"
  description="Neem contact op met AK Web Solutions. We reageren binnen één werkdag en plannen graag een strategiecall om jouw groeidoel te bespreken."
  structuredData={[breadcrumbSchema, contactSchema, faqSchema]}
>
  <Header />
  <main class="services-basic">
    <!-- Hero Section -->
    <section class="services-basic__hero">
      <div class="services-basic__shell">
        <div class="services-basic__hero-content" data-reveal>
          <h1>Laten we je website verbeteren.</h1>
          <p>Vul het formulier in of bel direct. We reageren binnen 1 werkdag met een concrete aanpak en vrijblijvend advies over je huidige site.</p>
        </div>

        <!-- Quick Stats -->
        <div class="services-basic__stats">
          {heroMetrics.map((metric, index) => (
            <div class="services-basic__stat" data-reveal style={`--reveal-delay: ${index * 0.08}s`}>
              <strong class="services-basic__stat-value">{metric.value}</strong>
              <span class="services-basic__stat-label">{metric.label}</span>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Contact Form + Info Section -->
    <section class="services-basic__section" style="padding-top: clamp(4rem, 8vw, 6rem);">
      <div class="services-basic__shell">
        <div class="services-basic__grid services-basic__grid--2">
          
          <!-- Contact Info Side -->
          <aside class="services-basic__card" data-reveal>
            <h2 style="font-size: 1.75rem; margin-bottom: 1rem;">Direct contact</h2>
            <p style="color: rgba(244, 244, 255, 0.72); margin-bottom: 2rem;">Liever direct bellen of mailen? Dat kan ook.</p>
            
            <div class="services-basic__contact-list">
              <div class="services-basic__contact-item">
                <span class="services-basic__contact-label">Telefoon</span>
                <a href="tel:+31685722387" class="services-basic__contact-link">+31 (0)6 85 72 23 87</a>
              </div>
              <div class="services-basic__contact-item">
                <span class="services-basic__contact-label">E-mail</span>
                <a href="mailto:info@akwebsolutions.nl" class="services-basic__contact-link">info@akwebsolutions.nl</a>
              </div>
              <div class="services-basic__contact-item">
                <span class="services-basic__contact-label">Locatie</span>
                <p class="services-basic__contact-text">Baarn, Nederland</p>
              </div>
            </div>

            <div style="margin-top: 2.5rem; padding-top: 2rem; border-top: 1px solid rgba(99, 102, 241, 0.1);">
              <h3 style="font-size: 1.125rem; margin-bottom: 1rem;">Wat krijg je?</h3>
              <ul style="list-style: none; padding: 0; display: flex; flex-direction: column; gap: 0.75rem;">
                {heroHighlights.map((item) => (
                  <li style="display: flex; gap: 0.75rem; align-items: start;">
                    <span style="flex-shrink: 0; width: 1.25rem; height: 1.25rem; border-radius: 50%; background: rgba(99, 102, 241, 0.15); display: flex; align-items: center; justify-content: center; margin-top: 0.125rem;">
                      <IconBadge set={item.icon.set} name={item.icon.name} width={14} color="rgba(99, 102, 241, 0.9)" />
                    </span>
                    <div>
                      <strong style="display: block; font-size: 0.9375rem; margin-bottom: 0.25rem;">{item.title}</strong>
                      <span style="font-size: 0.875rem; color: rgba(244, 244, 255, 0.62);">{item.body}</span>
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          </aside>

          <!-- Form Side -->
          <form id="contactForm" class="services-basic__form" data-reveal style="--reveal-delay: 0.1s">
            <!-- Honeypot for spam protection -->
            <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off" />

            <h2 style="font-size: 1.75rem; margin-bottom: 0.5rem;">Vraag een offerte aan</h2>
            <p style="color: rgba(244, 244, 255, 0.72); margin-bottom: 2rem;">Vul je gegevens in en vertel kort waar we je mee kunnen helpen. We nemen binnen 1 werkdag contact op.</p>
            
            <!-- Success/Error Messages -->
            <div id="formMessage" style="display: none; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; font-size: 0.9375rem;"></div>

            <div class="services-basic__form-grid">
              <label class="services-basic__field">
                <span>Naam *</span>
                <input required type="text" name="name" placeholder="Voor- en achternaam" />
              </label>
              <label class="services-basic__field">
                <span>E-mail *</span>
                <input required type="email" name="email" placeholder="jij@bedrijf.nl" />
              </label>
              <label class="services-basic__field">
                <span>Telefoon</span>
                <input type="tel" name="phone" placeholder="06 12 34 56 78" />
              </label>
              <label class="services-basic__field">
                <span>Bedrijf / Website</span>
                <input type="text" name="company" placeholder="Bedrijfsnaam of website URL" />
              </label>
              <label class="services-basic__field services-basic__field--full">
                <span>Waar kunnen we je mee helpen? *</span>
                <textarea required name="message" rows="6" placeholder="Bijvoorbeeld: Nieuwe website bouwen, huidige site sneller maken, SEO verbeteren..."></textarea>
              </label>
            </div>

            <button type="submit" id="submitBtn" class="services-basic__btn services-basic__btn--primary" style="width: 100%; position: relative;">
              <span id="btnText">Verstuur aanvraag</span>
              <span id="btnLoader" style="display: none;">
                <svg style="width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle;" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <circle cx="12" cy="12" r="10" stroke-width="4" stroke="currentColor" stroke-opacity="0.25"></circle>
                  <path d="M12 2a10 10 0 0 1 10 10" stroke-width="4" stroke="currentColor"></path>
                </svg>
                Versturen...
              </span>
            </button>
            <style>
              @keyframes spin {
                to { transform: rotate(360deg); }
              }
            </style>
            <p style="font-size: 0.8125rem; color: rgba(244, 244, 255, 0.52); text-align: center; margin-top: 1rem;">
              We reageren binnen 1 werkdag • Vrijblijvend advies
            </p>
          </form>

        </div>
      </div>
    </section>

    <!-- FAQ Section - Compact -->
    <section class="services-basic__section">
      <div class="services-basic__shell">
        <header class="services-basic__intro" data-reveal>
          <h2>Veelgestelde vragen</h2>
          <p>Snel antwoord op de meest gestelde vragen over onze werkwijze.</p>
        </header>
        <div class="services-basic__faq">
          {faqs.map((item, index) => (
            <details class="services-basic__faq-item" data-reveal style={`--reveal-delay: ${index * 0.08}s`}>
              <summary>{item.question}</summary>
              <p>{item.answer}</p>
            </details>
          ))}
        </div>
      </div>
    </section>

  </main>
  <Footer />
</Layout>

<script>
  // Professional contact form with reCAPTCHA v3 and Resend API
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contactForm') as HTMLFormElement | null;
    const submitBtn = document.getElementById('submitBtn') as HTMLButtonElement | null;
    const btnText = document.getElementById('btnText') as HTMLSpanElement | null;
    const btnLoader = document.getElementById('btnLoader') as HTMLSpanElement | null;
    const formMessage = document.getElementById('formMessage') as HTMLDivElement | null;

    if (!form || !submitBtn || !btnText || !btnLoader || !formMessage) return;

    form.addEventListener('submit', async (e: Event) => {
      e.preventDefault();

      // Check honeypot (spam protection)
      const honeypot = form.querySelector('[name="_honey"]') as HTMLInputElement;
      if (honeypot && honeypot.value) {
        return; // Silent fail for bots
      }

      // Disable submit button and show loading
      submitBtn.disabled = true;
      btnText.style.display = 'none';
      btnLoader.style.display = 'inline-block';
      formMessage.style.display = 'none';

      try {
        // Check if grecaptcha is loaded
        if (typeof (window as any).grecaptcha === 'undefined') {
          throw new Error('reCAPTCHA niet geladen');
        }

        // Execute reCAPTCHA v3
        const token = await new Promise<string>((resolve, reject) => {
          (window as any).grecaptcha.ready(() => {
            (window as any).grecaptcha
              .execute((window as any).RECAPTCHA_SITE_KEY || '6Lfg5fErAAAAAFNB6fEZq1TBrAKH1zysHKXVhCZv', { action: 'contact_form' })
              .then(resolve)
              .catch(reject);
          });
        });

        // Get form data
        const formData = new FormData(form);
        const data = {
          name: formData.get('name'),
          email: formData.get('email'),
          phone: formData.get('phone') || '',
          company: formData.get('company') || '',
          message: formData.get('message'),
          recaptchaToken: token
        };

        // Submit to API
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok) {
          // Success!
          formMessage.style.display = 'block';
          formMessage.style.background = 'rgba(34, 197, 94, 0.1)';
          formMessage.style.color = '#22c55e';
          formMessage.style.border = '1px solid rgba(34, 197, 94, 0.3)';
          formMessage.innerHTML = `
            <strong>✓ ${result.message}</strong><br>
            <span style="font-size: 0.875rem; opacity: 0.8;">We sturen je een bevestiging naar ${data.email}</span>
          `;
          
          // Reset form
          form.reset();

          // Scroll to success message
          formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });

        } else {
          // Error from API
          throw new Error(result.error || 'Er ging iets mis');
        }

      } catch (error) {
        // Show error message
        formMessage.style.display = 'block';
        formMessage.style.background = 'rgba(239, 68, 68, 0.1)';
        formMessage.style.color = '#ef4444';
        formMessage.style.border = '1px solid rgba(239, 68, 68, 0.3)';
        formMessage.innerHTML = `
          <strong>✗ ${error instanceof Error ? error.message : 'Er ging iets mis'}</strong><br>
          <span style="font-size: 0.875rem; opacity: 0.8;">Probeer het opnieuw of mail naar info@akwebsolutions.nl</span>
        `;

        console.error('Contact form error:', error);
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        btnText.style.display = 'inline-block';
        btnLoader.style.display = 'none';
      }
    });
  });
</script>
